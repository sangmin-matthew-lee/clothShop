{% extends 'shopping/basic.html' %} {% block title%}All Products{% endblock %}
{% block css %}
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 16px;
}
.product-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
{% endblock %}
{% block body %}
<div class="container my-4">
  <h4 class="mb-3">All Products</h4>
  <div class="product-grid">
    {% for i in products %}
    <div class="card product-card">
      <img src="/media/{{i.image}}" class="card-img-top" alt="{{ i.product_name }}" />
      <div class="card-body">
        <h5 class="card-title" id="namepr{{i.id}}">{{ i.product_name }}</h5>
        <p class="card-text">{{ i.desc|slice:"0:80" }}{% if i.desc|length > 80 %}...{% endif %}</p>
        <h6 class="card-title">Price: <span id="pricepr{{i.id}}">{{ i.price }}</span></h6>
        <div class="d-flex align-items-center">
          <span id="divpr{{i.id}}" class="divpr mr-2">
            <button id="pr{{i.id}}" class="btn btn-primary cart">Add To Cart</button>
          </span>
          <a href="/shopping/products/{{i.id}}">
            <button id="qv{{i.id}}" class="btn btn-outline-primary">QuickView</button>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %} {% block js %}
<script>
  if (localStorage.getItem("cart") == null) {
    var cart = {};
  } else {
    cart = JSON.parse(localStorage.getItem("cart"));
    updateCart(cart);
  }

  $(".divpr").on("click", "button.cart", function () {
    var idstr = this.id.toString();
    if (cart[idstr] != undefined) {
      qty = cart[idstr][0] + 1;
    } else {
      qty = 1;
      name = document.getElementById("name" + idstr).innerHTML;
      price = document.getElementById("price" + idstr).innerHTML;
      cart[idstr] = [qty, name, parseInt(price)];
    }
    updateCart(cart);
  });

  function updatePopover(cart) {
    var popStr = "";
    popStr += "<h5> Cart for your items in my shopping cart </h5><div class='mx-2 my-2'>";
    var i = 1;
    for (var item in cart) {
      var name = document.getElementById("name" + item).innerHTML;
      popStr +=
        "<div class='d-flex justify-content-between align-items-start mb-1'>" +
        "<div class='d-flex align-items-start'><b class='mr-1'>" +
        i +
        ".</b><span class='cart-pop-name'>" +
        name +
        "</span></div>" +
        "</div>";
      i = i + 1;
    }
    popStr +=
      "</div> <a href='/shopping/checkout'><button class='btn btn-primary' id ='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='localStorage.clear(); location.reload();' id ='clearCart'>Clear Cart</button>     ";
    var popcartEl = document.getElementById("popcart");
    popcartEl.setAttribute("data-content", popStr);
    $("#popcart").popover("dispose");
    document.getElementById("popcart").onclick = function () {
      window.location.href = "/shopping/checkout/";
    };
  }

  function updateCart(cart) {
    var sum = 0;
    for (var item in cart) {
      sum = sum + cart[item][0];
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    document.getElementById("cart").innerHTML = sum;
    updatePopover(cart);
  }
</script>
{% endblock %}
