{% extends 'shopping/basic.html' %} {% block title%} ClothShop{% endblock %}
{% block css %}
.hero {
  background: linear-gradient(135deg, #0b132b, #1c2541 50%, #3a506b);
  color: #e7f1ff;
  border-radius: 18px;
  padding: 40px 36px;
  box-shadow: 0 18px 40px rgba(13, 27, 42, 0.25);
}
.hero h2 {
  font-size: 2rem;
}
.cta-buttons .btn {
  margin-right: 10px;
}
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 16px;
}
.product-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.perk-card {
  background: #f8f9fb;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 10px 26px rgba(0,0,0,0.08);
}
{% endblock %}
{% block body %}
<div class="container my-4">
  <div class="hero mb-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start">
      <div class="mb-3 mb-md-0">
        <small class="text-light">Your personal shopping hub</small>
        <h2 class="mb-2">Discover daily picks, deals, and fresh arrivals.</h2>
        <p class="mb-3">Browse everything in one place or get AI deals tailored to you.</p>
        <div class="cta-buttons">
          <a class="btn btn-info" href="/shopping/all-products/">Shop all products</a>
          <a class="btn btn-outline-light" href="/shopping/recommend/">Ask AI Deals</a>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-4">
      <div class="perk-card h-100">
        <h6>Today's highlights</h6>
        <p class="mb-1">Check out whatâ€™s trending with our shoppers.</p>
        <a href="/shopping/all-products/">See all</a>
      </div>
    </div>
    <div class="col-md-4">
      <div class="perk-card h-100">
        <h6>Fast delivery</h6>
        <p class="mb-1">We ship quickly so you get your picks sooner.</p>
        <span class="text-muted">Local & nationwide</span>
      </div>
    </div>
    <div class="col-md-4">
      <div class="perk-card h-100">
        <h6>Easy returns</h6>
        <p class="mb-1">Change your mind? Simple return support.</p>
        <a href="/shopping/tracker">Track orders</a>
      </div>
    </div>
  </div>

  <h4 class="mb-3">Featured picks</h4>
  <div class="product-grid">
    {% for i in featured %}
    <div class="card product-card">
      <img src="/media/{{i.image}}" class="card-img-top" alt="{{ i.product_name }}" />
      <div class="card-body">
        <h5 class="card-title" id="namepr{{i.id}}">{{ i.product_name }}</h5>
        <p class="card-text">{{ i.desc|slice:"0:80" }}{% if i.desc|length > 80 %}...{% endif %}</p>
        <h6 class="card-title">Price: <span id="pricepr{{i.id}}">{{ i.price }}</span></h6>
        <div class="d-flex align-items-center">
          <span id="divpr{{i.id}}" class="divpr mr-2">
            <button id="pr{{i.id}}" class="btn btn-primary cart">Add To Cart</button>
          </span>
          <a href="/shopping/products/{{i.id}}">
            <button id="qv{{i.id}}" class="btn btn-outline-primary">QuickView</button>
          </a>
        </div>
      </div>
    </div>
    {% empty %}
    <p>No products yet. Add some to see featured picks here.</p>
    {% endfor %}
  </div>
</div>
{% endblock %} {% block js %}
<script>
  if (localStorage.getItem("cart") == null) {
    var cart = {};
  } else {
    cart = JSON.parse(localStorage.getItem("cart"));
    updateCart(cart);
  }

  $(".divpr").on("click", "button.cart", function () {
    var idstr = this.id.toString();
    if (cart[idstr] != undefined) {
      qty = cart[idstr][0] + 1;
    } else {
      qty = 1;
      name = document.getElementById("name" + idstr).innerHTML;
      price = document.getElementById("price" + idstr).innerHTML;
      cart[idstr] = [qty, name, parseInt(price)];
    }
    updateCart(cart);
  });

  function updatePopover(cart) {
    var popStr = "";
    popStr += "<h5> Cart for your items in my shopping cart </h5><div class='mx-2 my-2'>";
    var i = 1;
    for (var item in cart) {
      var name = document.getElementById("name" + item).innerHTML;
      popStr +=
        "<div class='d-flex justify-content-between align-items-start mb-1'>" +
        "<div class='d-flex align-items-start'><b class='mr-1'>" +
        i +
        ".</b><span class='cart-pop-name'>" +
        name +
        "</span></div>" +
        "</div>";
      i = i + 1;
    }
    popStr +=
      "</div> <a href='/shopping/checkout'><button class='btn btn-primary' id ='checkout'>Checkout</button></a> <button class='btn btn-primary' onclick='localStorage.clear(); location.reload();' id ='clearCart'>Clear Cart</button>     ";
    var popcartEl = document.getElementById("popcart");
    popcartEl.setAttribute("data-content", popStr);
    $("#popcart").popover("dispose");
    document.getElementById("popcart").onclick = function () {
      window.location.href = "/shopping/checkout/";
    };
  }

  function updateCart(cart) {
    var sum = 0;
    for (var item in cart) {
      sum = sum + cart[item][0];
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    document.getElementById("cart").innerHTML = sum;
    updatePopover(cart);
  }
</script>
{% endblock %}
